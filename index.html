<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Slideshow with Four Slides</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
        }
        .slideshow-container {
            width: 100%;
            max-width: 1200px;
            margin: auto;
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .slide {
            display: none;
        }
        .slide img, .slide svg {
            width: 100%;
            height: auto;
            max-height: 600px;
            object-fit: cover;
        }
        .slide-content {
            padding: 20px;
        }
        .slide-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .slide-description {
            font-size: 16px;
            line-height: 1.5;
        }
        .button-container {
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            background-color: #f8f8f8;
        }
        .btn {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            cursor: pointer;
            transition-duration: 0.4s;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .btn:disabled {
            background-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
        }

        /* Media Queries for Responsive Design */
        @media screen and (max-width: 768px) {
            .slideshow-container {
                max-width: 90%;
            }
            .slide-title {
                font-size: 20px;
            }
            .slide-description {
                font-size: 14px;
            }
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        @media screen and (max-width: 480px) {
            .slideshow-container {
                max-width: 95%;
            }
            .slide-title {
                font-size: 18px;
            }
            .slide-description {
                font-size: 12px;
            }
            .btn {
                padding: 8px 16px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="slideshow-container">   
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Welcome to Our Slideshow</h2>
                <p class="slide-description">Embark on a visual journey through diverse landscapes and artistic expressions. This slideshow showcases the beauty of our world in various forms.</p>
            </div>
            <img src="https://www.usatoday.com/gcdn/presto/2019/10/10/USAT/2f5771e7-5ae2-4676-8257-95a202722601-1_-_SFO_Airport_overview.jpg?crop=5759,3239,x1,y44&width=3200&height=1800&format=pjpg&auto=webp" alt="Welcome Slide">
        </div>
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Air Traffic Trends</h2>
                <p class="slide-description">Explore the trends in air traffic over the years, showcasing international, domestic, and total passenger numbers.</p>
                <div id="chart1"></div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Heatmap of Total Travel per Year-Month</h2>
                <p class="slide-description">Discover the vibrant energy of city life. This urban landscape captures the essence of modern architecture and bustling streets.</p>
                <div id="chart2"></div>
            </div>
        </div>
        <div class="slide">
            <div class="slide-content">
                <h2 class="slide-title">Abstract Wonders</h2>
                <p class="slide-description">Immerse yourself in the world of abstract art. This piece challenges perceptions and invites viewers to interpret its meaning.</p>
                <ul>
                    <li ><strong style="color: #ff9999;">Revenue Passenger-miles</strong> = the number of passengers and the distance flown in thousands (000)</li>
                    <li><strong style="color: #66ff66;">Available Seat-miles</strong> = the number of seats and the distance flown in thousands (000)</li>
                    <li ><strong style="color: #99ccff;">Load Factor</strong> = passenger-miles as a proportion of available seat-miles in percent (%)</li>
                </ul>
                <p>Click a button below to filter the viz based on domestic, international, or total</p>
                <div class="buttons">
                    <button onclick="updateChart('total')">Total</button>
                    <button onclick="updateChart('domestic')">Domestic</button>
                    <button onclick="updateChart('international')">International</button>
                </div>
                <div id="chart3"></div>
            </div>
        </div>
        <div class="button-container">
            <button id="prevBtn" class="btn" onclick="changeSlide(-1)">Previous</button>
            <button id="nextBtn" class="btn" onclick="changeSlide(1)">Continue</button>
        </div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');

        function showSlide(n) {
            slides[currentSlide].style.display = "none";
            currentSlide = (n + slides.length) % slides.length;
            slides[currentSlide].style.display = "block";
            updateButtons();
        }

        function changeSlide(n) {
            showSlide(currentSlide + n);
        }

        function updateButtons() {
            prevBtn.disabled = (currentSlide === 0);
            nextBtn.disabled = (currentSlide === slides.length - 1);
        }

        showSlide(0);

        // Chart 1: Air Traffic Trends
        d3.csv("https://raw.githubusercontent.com/jamesjellow/data/main/air_traffic.csv").then(data => {
            const parseDate = d3.timeParse("%Y-%m");

            data.forEach(d => {
                d.date = parseDate(d.Year + "-" + d.Month);
                d.international = +d.Int_Pax.replace(/,/g, '');
                d.domestic = +d.Dom_Pax.replace(/,/g, '');
                d.total = +d.Pax.replace(/,/g, '');
            });

            data.sort((a, b) => a.date - b.date);

            const margin = {top: 20, right: 20, bottom: 50, left: 90},
                  width = 1000 ,
                  height = 500 ;

            const x = d3.scaleTime().range([0, width]);
            const y = d3.scaleLinear().range([height, 0]);

            const lineInternational = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.international));

            const lineDomestic = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.domestic));

            const lineTotal = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.total));

            const svg = d3.select("#chart1").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            x.domain(d3.extent(data, d => d.date));
            y.domain([0, d3.max(data, d => Math.max(d.international, d.domestic, d.total))]);

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", 40)
                .attr("fill", "#000")
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text("Year");

            svg.append("g")
                .call(d3.axisLeft(y))
                .append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -80)
                .attr("fill", "#000")
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text("Number of Passengers");

            svg.append("path")
                .data([data])
                .attr("class", "line")
                .attr("d", lineInternational)
                .style("fill", "none")
                .style("stroke", "steelblue")
                .style("stroke-width", "1.5px");

            svg.append("path")
                .data([data])
                .attr("class", "line")
                .attr("d", lineDomestic)
                .style("fill", "none")
                .style("stroke", "green")
                .style("stroke-width", "1.5px");

            svg.append("path")
                .data([data])
                .attr("class", "line")
                .attr("d", lineTotal)
                .style("fill", "none")
                .style("stroke", "red")
                .style("stroke-width", "1.5px");

            const hoverGroupTotal = svg.append("g").attr("class", "hover-group-total");
            const hoverGroupDomestic = svg.append("g").attr("class", "hover-group-domestic");
            const hoverGroupInternational = svg.append("g").attr("class", "hover-group-international");

            function createHoverCircles(group, yAccessor, color) {
                group.selectAll(".hover-circle")
                    .data(data)
                    .enter().append("circle")
                    .attr("class", "hover-circle")
                    .attr("cx", d => x(d.date))
                    .attr("cy", d => y(yAccessor(d)))
                    .attr("r", 5)
                    .style("fill", color)
                    .style("opacity", 0.5)  // Make circles semi-transparent
                    .style("pointer-events", "all");
            }

            createHoverCircles(hoverGroupTotal, d => d.total, "none");
            createHoverCircles(hoverGroupDomestic, d => d.domestic, "none");
            createHoverCircles(hoverGroupInternational, d => d.international, "none");

            const tooltip = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0)
                .style("position", "absolute")
                .style("background-color", "white")
                .style("border", "1px solid #ddd")
                .style("padding", "10px")
                .style("border-radius", "5px")
                .style("pointer-events", "none");  // Prevent tooltip from interfering with hover

            function handleMouseOver(event, d, category) {
                console.log("Mouseover event triggered", category, d);  // Debug log
                d3.select(this).style("opacity", 1);  // Make hovered circle fully opaque
                tooltip.transition()
                    .duration(200)
                    .style("opacity", .9);
                tooltip.html(`Date: ${d3.timeFormat("%B %Y")(d.date)}<br/>
                            ${category}: ${d3.format(",")(d[category.toLowerCase()])}`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 28) + "px");
            }

            function handleMouseOut() {
                console.log("Mouseout event triggered");  // Debug log
                d3.select(this).style("opacity", 0.5);  // Return to semi-transparent
                tooltip.transition()
                    .duration(500)
                    .style("opacity", 0);
            }

            function addHoverToGroup(group, category) {
                group.selectAll(".hover-circle")
                    .on("mouseover", function(event, d) {
                        handleMouseOver.call(this, event, d, category);
                    })
                    .on("mouseout", handleMouseOut);
            }

            addHoverToGroup(hoverGroupTotal, "Total");
            addHoverToGroup(hoverGroupDomestic, "Domestic");
            addHoverToGroup(hoverGroupInternational, "International");

            const legend = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${width - 100},${250})`);

            legend.append("rect")
                .attr("width", 140)
                .attr("height", 80)
                .attr("fill", "white")
                .attr("stroke", "black");

            legend.append("text")
                .attr("x", 10)
                .attr("y", 20)
                .attr("fill", "steelblue")
                .style("text-anchor", "start")
                .text("International");

            legend.append("text")
                .attr("x", 10)
                .attr("y", 40)
                .attr("fill", "green")
                .style("text-anchor", "start")
                .text("Domestic");

            legend.append("text")
                .attr("x", 10)
                .attr("y", 60)
                .attr("fill", "red")
                .style("text-anchor", "start")
                .text("Total");

            legend.append("rect")
                .attr("x", 120)
                .attr("y", 10)
                .attr("width", 10)
                .attr("height", 10)
                .attr("fill", "steelblue");

            legend.append("rect")
                .attr("x", 120)
                .attr("y", 30)
                .attr("width", 10)
                .attr("height", 10)
                .attr("fill", "green");

            legend.append("rect")
                .attr("x", 120)
                .attr("y", 50)
                .attr("width", 10)
                .attr("height", 10)
                .attr("fill", "red");

            const annotations = [
                {
                    note: {
                        label: "COVID-19 Pandemic",
                        title: "March 2020",
                        align: "middle",
                        wrap: 200
                    },
                    // Can use x, y directly instead of data
                    data: { date: new Date(2020, 3), total: 3013899 },
                    dy: -100,
                    dx: -50,
                    subject: { radius: 3 }
                },
                {
                    note: {
                        label: "Pre-Pandemic Peak",
                        title: "July 2019",
                        align: "middle",
                        wrap: 200
                    },
                    data: { date: new Date(2019, 6, 1), total: 86_925_851 },
                    dy: 0,
                    dx: -200,
                    subject: { radius: 4 }
                }
            ];

            const makeAnnotations = d3.annotation()
                .type(d3.annotationCalloutCircle)
                .accessors({
                    x: d => x(d.date),
                    y: d => y(d.total)
                })
                .annotations(annotations);

            svg.append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations);
        });
        

        // Chart 2
        d3.csv("https://raw.githubusercontent.com/jamesjellow/data/main/air_traffic.csv").then(data => {
            const margin = {top: 20, right: 20, bottom: 50, left: 90},
                  width = 1000 ,
                  height = 500 ;

            const svg = d3.select("#chart2")
                        .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

            data.forEach(d => {
                d.Year = +d.Year;
                d.Month = +d.Month;
                d.Pax = +d.Pax.replace(/,/g, '');
            });

            const years = Array.from(new Set(data.map(d => d.Year)));
            const months = d3.range(1, 13);

            const x = d3.scaleBand()
                        .range([0, width])
                        .domain(years)
                        .padding(0.05);

            const y = d3.scaleBand()
                        .range([height, 0])
                        .domain(months)
                        .padding(0.05);

            const colorScale = d3.scaleSequential()
                                .interpolator(d3.interpolateRdYlBu)
                                .domain([d3.max(data, d => d.Pax), 0]);

            svg.selectAll()
            .data(data)
            .enter()
            .append("rect")
            .attr("x", d => x(d.Year))
            .attr("y", d => y(d.Month))
            .attr("width", x.bandwidth())
            .attr("height", y.bandwidth())
            .style("fill", d => colorScale(d.Pax));

            svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x));

            svg.append("g")
            .call(d3.axisLeft(y).tickFormat(d => d3.timeFormat("%B")(new Date(2000, d - 1, 1))));

            const tooltip = d3.select("body").append("div")
                            .style("position", "absolute")
                            .style("text-align", "center")
                            .style("width", "auto")
                            .style("height", "auto")
                            .style("padding", "5px")
                            .style("font", "12px sans-serif")
                            .style("background", "lightsteelblue")
                            .style("border", "0px")
                            .style("border-radius", "8px")
                            .style("pointer-events", "none")
                            .style("opacity", 0);

            svg.selectAll("rect")
            .on("mouseover", function(event, d) {
                tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                tooltip.html(`Year: ${d.Year}<br/>Month: ${d3.timeFormat("%B")(new Date(2000, d.Month - 1, 1))}<br/>Passengers: ${d3.format(",")(d.Pax)}`)
                        .style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", function(d) {
                tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
            });

            const legendWidth = 300;
            const legendHeight = 20;
            const legendMargin = { top: 10, right: 10, bottom: 10, left: 10 };

            const legendSvg = svg.append("g")
                .attr("class", "legend")
                .attr("transform", `translate(${(width - legendWidth) / 2},${height + margin.top + legendMargin.top})`);

            const legendScale = d3.scaleSequential()
                                .interpolator(d3.interpolateRdYlBu)
                                .domain([d3.max(data, d => d.Pax), 0]);

            const defs = legendSvg.append("defs");

            const linearGradient = defs.append("linearGradient")
                .attr("id", "linear-gradient");

            linearGradient.selectAll("stop")
                .data(d3.range(0, 1.01, 0.01))
                .enter().append("stop")
                .attr("offset", d => d)
                .attr("stop-color", d => legendScale(d3.interpolate(0, d3.max(data, d => d.Pax))(d))); // Reverse color gradient

            legendSvg.append("rect")
                .attr("x", legendMargin.left)
                .attr("y", legendMargin.top)
                .attr("width", legendWidth - legendMargin.left - legendMargin.right)
                .attr("height", legendHeight)
                .style("fill", "url(#linear-gradient)");

            const legendAxisScale = d3.scaleLinear()
                                    .domain([0, d3.max(data, d => d.Pax)])
                                    .range([0, legendWidth - legendMargin.left - legendMargin.right]);

            svg.append("text")
                .attr("x", (width - legendWidth) / 2 + legendMargin.left - 20)
                .attr("y", height + margin.top + legendMargin.top + legendHeight + 12)
                .attr("dy", "-0.3em")
                .attr("text-anchor", "middle")
                .style("fill", "#000")
                .style("font-size", "12px")
                .text("Cold");

            svg.append("text")
                .attr("x", (width + legendWidth) / 2 - legendMargin.right + 15)
                .attr("y", height + margin.top + legendMargin.top + legendHeight + 12)
                .attr("dy", "-0.3em")
                .attr("text-anchor", "middle")
                .style("fill", "#000")
                .style("font-size", "12px")
                .text("Hot");
        });
    
        // Chart 3
        

        let currentMode = "Total";

        const margin = {top: 20, right: 20, bottom: 50, left: 90},
                  width = 1000 ,
                  height = 500 ;

        const svg = d3.select("#chart3")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

        const modeText = svg.append("text")
            .attr("x", 10)
            .attr("y", -10)
            .attr("dy", "1em")
            .attr("class", "mode-text")
            .style("text-anchor", "start")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .text(`Filter: ${currentMode}`);

        const tooltip = d3.select("#tooltip");

        svg.append("g").attr("class", "x-axis").attr("transform", `translate(0,${height})`);
        svg.append("g").attr("class", "y-axis");

        // Add axis labels
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left + 10)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("ASM / RPM / LF");

        svg.append("text")
            .attr("x", width / 2)
            .attr("y", height + margin.bottom)
            .style("text-anchor", "middle")
            .text("Years");

        let csvData;
        let aggregatedData;

        d3.csv("https://raw.githubusercontent.com/jamesjellow/data/main/air_traffic.csv").then(data => {
            csvData = data;
            // Convert string numbers with commas to floats
            csvData.forEach(d => {
                d.Year = +d.Year;
                d.Month = +d.Month;
                d.Dom_ASM = +d.Dom_ASM.replace(/,/g, '');
                d.Int_ASM = +d.Int_ASM.replace(/,/g, '');
                d.ASM = +d.ASM.replace(/,/g, '');
                d.Dom_RPM = +d.Dom_RPM.replace(/,/g, '');
                d.Int_RPM = +d.Int_RPM.replace(/,/g, '');
                d.RPM = +d.RPM.replace(/,/g, '');
                d.Dom_LF = +d.Dom_LF;
                d.Int_LF = +d.Int_LF;
                d.LF = +d.LF;
            });

            updateChart('total');
        });

        const x = d3.scaleBand().range([0, width]).padding(0.2);
        const y = d3.scaleLinear().range([height, 0]);
        const color = d3.scaleOrdinal().range(["#ff9999", "#66ff66", "#99ccff"]);

        function customTickFormat(d) {
            if (d >= 1e9) {
                return d3.format(".1f")(d / 1e9) + "B";
            } else if (d >= 1e6) {
                return d3.format(".1f")(d / 1e6) + "M";
            } else {
                return d;
            }
        }

        function updateChart(filter) {
            let filteredData;
            if (filter === 'total') {
                currentMode = "Total";
                filteredData = csvData.map(d => ({
                    Year: d.Year,
                    ASM: d.ASM,
                    RPM: d.RPM,
                    LF: d.LF
                }));
            } else if (filter === 'domestic') {
                currentMode = "Domestic";
                filteredData = csvData.map(d => ({
                    Year: d.Year,
                    ASM: d.Dom_ASM,
                    RPM: d.Dom_RPM,
                    LF: d.Dom_LF
                }));
            } else if (filter === 'international') {
                currentMode = "International";
                filteredData = csvData.map(d => ({
                    Year: d.Year,
                    ASM: d.Int_ASM,
                    RPM: d.Int_RPM,
                    LF: d.Int_LF
                }));
            }

            modeText.text(`Filter: ${currentMode}`);

            const groupedData = d3.group(filteredData, d => d.Year);
            aggregatedData = Array.from(groupedData, ([key, values]) => ({
                Year: key,
                ASM: d3.sum(values, d => d.ASM),
                RPM: d3.sum(values, d => d.RPM),
                LF: d3.mean(values, d => d.LF)
            }));

            const finalData = aggregatedData.map(d => ({
                year: d.Year,
                ASM: d.ASM,
                RPM: d.RPM,
                LF: d.LF / 100 * (d.ASM + d.RPM) // Scale LF to fit within the chart
            }));

            x.domain(finalData.map(d => d.year));
            y.domain([0, d3.max(finalData, d => d.ASM + d.RPM + d.LF)]);

            const tickYears = finalData.map(d => d.year)
                                    .filter((v, i, a) => a.indexOf(v) === i && v % 5 === 3); // Show years 2003, 2008, 2013, etc.

            svg.select(".x-axis")
                .call(d3.axisBottom(x).tickValues(tickYears).tickFormat(d3.format("d")))
                .selectAll("text")
                .style("text-anchor", "end");

            svg.select(".y-axis").call(d3.axisLeft(y).ticks(10).tickFormat(customTickFormat));

            const keys = ["ASM", "RPM", "LF"];
            const stack = d3.stack().keys(keys);
            const stackedData = stack(finalData);

            const bars = svg.selectAll(".layer")
                            .data(stackedData, d => d.key);

            bars.enter().append("g")
                .attr("class", "layer")
                .attr("fill", d => {
                    if (d.key === 'ASM') return "#ff9999"; // Light red
                    if (d.key === 'RPM') return "#66ff66"; // Light green
                    if (d.key === 'LF') return "#99ccff"; // Light blue
                });

            bars.exit().remove();

            const layers = svg.selectAll(".layer")
                            .data(stackedData, d => d.key);

            const rects = layers.selectAll("rect")
                                .data(d => d);

            rects.enter().append("rect")
                .attr("x", d => x(d.data.year))
                .attr("width", x.bandwidth())
                .attr("y", d => y(0))
                .attr("height", 0)
                .merge(rects)
                .transition()
                .duration(750)
                .attr("x", d => x(d.data.year))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d[1]))
                .attr("height", d => y(d[0]) - y(d[1]));

            rects.exit().remove();

            svg.selectAll("rect")
                .on("mouseover", function(event, d) {
                    const category = d3.select(this.parentNode).datum().key;
                    let value;
                    if (category === 'ASM') value = d3.format(",")(d.data.ASM);
                    else if (category === 'RPM') value = d3.format(",")(d.data.RPM);
                    else if (category === 'LF') value = d3.format(".2%")(d.data.LF / (d.data.ASM + d.data.RPM));

                    tooltip.transition().duration(200).style("opacity", .9);
                    tooltip.html(`Year: ${d.data.year}<br/>${category}: ${value}`)
                        .style("left", (event.pageX) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", () => {
                    tooltip.transition().duration(500).style("opacity", 0);
                });
        }
    </script>
</body>
</html>